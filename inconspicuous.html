<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EmulatorJS - Upload ROM and Choose Core</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #000;
        }
        #controls {
            position: absolute;
            z-index: 10;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-family: sans-serif;
        }
        input, button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label for="coreInput">Core (e.g. nes, snes, gba, n64):</label>
        <input type="text" id="coreInput" placeholder="nes" />
        <br>
        <label for="fileInput">Upload ROM:</label>
        <input type="file" id="fileInput" accept=".nes,.sfc,.smc,.gba,.gb,.gbc,.n64,.zip" />
    </div>

    <div style="width:100%;height:100%;max-width:100%">
        <div id="game"></div>
    </div>

    <script>
        const pathtodata = "https://cdn.emulatorjs.org/latest/data/";
        const color = "#0097c4";
        const backgroundImage = "https://allancoding-files.netlify.app/snes-nes/SMB3.jpg";
        const backgroundColor = "#000";
        const playerElement = "#game";

        document.getElementById("fileInput").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const core = document.getElementById("coreInput").value.trim().toLowerCase();
            if (!core) {
                alert("Please enter a valid core (e.g. nes, snes, gba)");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const arrayBuffer = e.target.result;
                const blob = new Blob([arrayBuffer], { type: "application/octet-stream" });
                const objectUrl = URL.createObjectURL(blob);

                // Setup EmulatorJS config
                EJS_player = playerElement;
                EJS_core = core;
                EJS_pathtodata = pathtodata;
                EJS_color = color;
                EJS_backgroundImage = backgroundImage;
                EJS_backgroundColor = backgroundColor;
                EJS_gameUrl = objectUrl;

                // Start Emulator
                const script = document.createElement("script");
                script.src = "https://cdn.emulatorjs.org/latest/data/loader.js";
                document.body.appendChild(script);
            };
            reader.readAsArrayBuffer(file);
        });
    </script>
</body>
</html>

